<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sniiice</title>
  <style>
    :root {
      color-scheme: dark;
    }
    body {
      margin: 0;
      font-family: "Arial", sans-serif;
      background: #111;
      color: #e8e8e8;
      display: grid;
      place-items: center;
      min-height: 100vh;
    }
    .wrap {
      display: grid;
      gap: 12px;
      justify-items: center;
    }
    canvas {
      border: 2px solid #2c2c2c;
      background: #000;
      image-rendering: pixelated;
    }
    .hud {
      display: flex;
      gap: 16px;
      align-items: center;
      font-size: 14px;
    }
    .key {
      padding: 2px 6px;
      border: 1px solid #333;
      border-radius: 4px;
      background: #1a1a1a;
    }
    .title {
      font-size: 18px;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">Sniiice (NOISIA Films, 2007) — Web Edition</div>
    <canvas id="game" width="600" height="400"></canvas>
    <div class="hud">
      <span class="key">Players: 1-4</span>
      <span class="key">P1: ↑ → ↓ ←</span>
      <span class="key">P2: W D S A</span>
      <span class="key">P3: Y J H G</span>
      <span class="key">P4: 8 6 5 4</span>
      <span class="key">Restart: Ctrl+R</span>
    </div>
  </div>

  <script>
    const WIDTH = 600;
    const HEIGHT = 400;
    const GAMESPEED = 5;
    const BLOCKLENGTH = 50;

    const COLORS = ["#2d6cff", "#ff4141", "#ff9f1a", "#3ddc84"];
    const KEYS = [
      ["ArrowUp", "ArrowRight", "ArrowDown", "ArrowLeft"],
      ["w", "d", "s", "a"],
      ["y", "j", "h", "g"],
      ["8", "6", "5", "4"],
    ];

    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    let blocks = [];
    let players = 0;
    let playersLeft = 0; // 0: starting, >0: playing, negative: winner
    let controlDown = false;

    class Block {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.hSpeed = 0;
        this.vSpeed = 0;
        this.alive = true;
      }
      isAlive() {
        return this.alive;
      }
      kill() {
        this.alive = false;
      }
      act() {
        this.x += this.hSpeed;
        this.y += this.vSpeed;
      }
      setHDirection(dir) {
        this.hSpeed = dir * (2 * GAMESPEED);
      }
      setVDirection(dir) {
        this.vSpeed = dir * (2 * GAMESPEED);
      }
      setHSpeed(speed) {
        this.hSpeed = speed;
      }
      setVSpeed(speed) {
        this.vSpeed = speed;
      }
      getHSpeed() {
        return this.hSpeed;
      }
      getVSpeed() {
        return this.vSpeed;
      }
    }

    function initBlocks(count) {
      playersLeft = count;
      players = count;
      blocks = new Array(players);
      const halfwayV = HEIGHT / 2 + BLOCKLENGTH / 2;
      const halfwayH = WIDTH / 2 - BLOCKLENGTH / 2;
      for (let i = 0; i < players; i += 1) {
        switch (i) {
          case 0:
            blocks[i] = new Block(35, halfwayV);
            break;
          case 1:
            blocks[i] = new Block(WIDTH - 85, halfwayV);
            break;
          case 2:
            blocks[i] = new Block(halfwayH, HEIGHT - 35);
            break;
          case 3:
            blocks[i] = new Block(halfwayH, 85);
            break;
        }
      }
    }

    function handleCollisions(a, b) {
      const xi = Math.abs(a.x - b.x);
      const yi = Math.abs(a.y - b.y);
      if (xi >= BLOCKLENGTH / 2 && xi <= BLOCKLENGTH) {
        if (yi <= BLOCKLENGTH) {
          const temp = a.getHSpeed();
          a.setHSpeed(b.getHSpeed());
          b.setHSpeed(temp);
        }
      }
      if (yi >= BLOCKLENGTH / 2 && yi <= BLOCKLENGTH) {
        if (xi <= BLOCKLENGTH) {
          const temp = a.getVSpeed();
          a.setVSpeed(b.getVSpeed());
          b.setVSpeed(temp);
        }
      }
    }

    function drawBounds() {
      ctx.strokeStyle = "#444";
      ctx.strokeRect(25, 25, WIDTH - 50, HEIGHT - 50);
      ctx.fillStyle = "#b4b4b4";
      ctx.fillText("Graveyard:", 25, HEIGHT - 6);
      ctx.fillText("NOISIA Films", 28, 40);
    }

    function drawStartPrompt() {
      ctx.fillStyle = "#e8e8e8";
      ctx.fillText(
        "How many players? (Type 1, 2, 3, or 4)",
        WIDTH / 2 - 130,
        HEIGHT / 2
      );
    }

    function drawWinner() {
      const winnerIndex = -(playersLeft + 1);
      ctx.fillStyle = COLORS[winnerIndex] || "#fff";
      ctx.fillText(`Player ${-playersLeft} wins!`, WIDTH / 2 - 40, HEIGHT / 2);
      ctx.fillText(
        `Take a victory dance, Player ${-playersLeft}`,
        WIDTH / 2 - 95,
        HEIGHT / 2 + 20
      );
      if (blocks[winnerIndex] && !blocks[winnerIndex].isAlive()) {
        ctx.fillText("- oops, you're dead", WIDTH / 2 - 60, HEIGHT / 2 + 40);
      }
      ctx.fillText("(Ctrl+R to play again)", WIDTH / 2 - 80, HEIGHT / 2 + 80);
    }

    function drawBlocks() {
      for (let i = 0; i < players; i += 1) {
        ctx.fillStyle = COLORS[i];
        if (blocks[i].isAlive()) {
          if (playersLeft === 1) {
            playersLeft = -i - 1;
          }
          const xPos = blocks[i].x;
          const yPos = blocks[i].y;

          if (
            xPos > WIDTH - 25 ||
            xPos + BLOCKLENGTH < 25 ||
            yPos - BLOCKLENGTH > HEIGHT - 25 ||
            yPos < 25
          ) {
            blocks[i].kill();
            if (playersLeft > 0) {
              playersLeft -= 1;
            }
            break;
          }

          blocks[i].act();
          for (let j = i; j < players - 1; j += 1) {
            handleCollisions(blocks[i], blocks[j + 1]);
          }
          ctx.fillRect(blocks[i].x, HEIGHT - blocks[i].y, BLOCKLENGTH, BLOCKLENGTH);
        } else {
          ctx.fillRect(100 + 60 * i, HEIGHT - 25, BLOCKLENGTH, 25);
        }
      }
    }

    function update() {
      ctx.clearRect(0, 0, WIDTH, HEIGHT);
      drawBounds();

      if (playersLeft < 0) {
        drawWinner();
      }

      if (playersLeft !== 0 && playersLeft <= players) {
        drawBlocks();
      } else if (playersLeft === 0) {
        drawStartPrompt();
      }

      requestAnimationFrame(update);
    }

    document.addEventListener("keydown", (event) => {
      const code = event.key;
      if (code === "Control") {
        controlDown = true;
      } else if (code.toLowerCase() === "r" && controlDown) {
        playersLeft = 0;
        blocks = [];
      } else if (playersLeft === 0) {
        if (["1", "2", "3", "4"].includes(code)) {
          initBlocks(Number(code));
        }
      }

      for (let i = 0; i < players; i += 1) {
        if (code === KEYS[i][0]) {
          blocks[i].setVDirection(1);
        } else if (code === KEYS[i][1]) {
          blocks[i].setHDirection(1);
        } else if (code === KEYS[i][2]) {
          blocks[i].setVDirection(-1);
        } else if (code === KEYS[i][3]) {
          blocks[i].setHDirection(-1);
        }
      }
    });

    document.addEventListener("keyup", (event) => {
      const code = event.key;
      if (code === "Control") {
        controlDown = false;
      }

      for (let i = 0; i < players; i += 1) {
        if (code === KEYS[i][0]) {
          blocks[i].setVDirection(0);
        } else if (code === KEYS[i][1]) {
          blocks[i].setHDirection(0);
        } else if (code === KEYS[i][2]) {
          blocks[i].setVDirection(0);
        } else if (code === KEYS[i][3]) {
          blocks[i].setHDirection(0);
        }
      }
    });

    ctx.font = "14px Arial";
    update();
  </script>
</body>
</html>
